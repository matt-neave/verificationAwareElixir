{:defmodule, [line: 1], [{:__aliases__, [line: 1], [:Replica]}, [do: {:__block__, [], [{:defp, [line: 4], [{:requests, [line: 4], [{:self, [line: 4], nil}, {:v, [line: 4], nil}]}, [do: {{:., [line: 4], [{:__aliases__, [line: 4], [:Map]}, :put]}, [line: 4], [{:self, [line: 4], nil}, :requests, {:++, [line: 4], [{{:., [line: 4], [{:self, [line: 4], nil}, :requests]}, [no_parens: true, line: 4], []}, [{:v, [line: 4], nil}]]}]}]]}, {:defp, [line: 5], [{:pop_request, [line: 5], [{:self, [line: 5], nil}]}, [do: {:if, [line: 6], [{:==, [line: 6], [{:length, [line: 6], [{{:., [line: 6], [{:self, [line: 6], nil}, :requests]}, [no_parens: true, line: 6], []}]}, 1]}, [do: {:__block__, [], [{:=, [line: 7], [[{:command, [line: 7], nil}], {{:., [line: 7], [{:self, [line: 7], nil}, :requests]}, [no_parens: true, line: 7], []}]}, {{{:., [line: 8], [{:__aliases__, [line: 8], [:Map]}, :put]}, [line: 8], [{:self, [line: 8], nil}, :requests, []]}, {:command, [line: 8], nil}}]}, else: {:__block__, [], [{:=, [line: 10], [[{:|, [line: 10], [{:command, [line: 10], nil}, {:remaining_commands, [line: 10], nil}]}], {{:., [line: 10], [{:self, [line: 10], nil}, :requests]}, [no_parens: true, line: 10], []}]}, {{{:., [line: 11], [{:__aliases__, [line: 11], [:Map]}, :put]}, [line: 11], [{:self, [line: 11], nil}, :requests, {:remaining_commands, [line: 11], nil}]}, {:command, [line: 11], nil}}]}]]}]]}, {:defp, [line: 14], [{:proposals, [line: 14], [{:self, [line: 14], nil}, {:k, [line: 14], nil}, {:v, [line: 14], nil}]}, [do: {{:., [line: 14], [{:__aliases__, [line: 14], [:Map]}, :put]}, [line: 14], [{:self, [line: 14], nil}, :proposals, {{:., [line: 14], [{:__aliases__, [line: 14], [:Map]}, :put]}, [line: 14], [{{:., [line: 14], [{:self, [line: 14], nil}, :proposals]}, [no_parens: true, line: 14], []}, {:k, [line: 14], nil}, {:v, [line: 14], nil}]}]}]]}, {:defp, [line: 15], [{:remove_proposal, [line: 15], [{:self, [line: 15], nil}, {:k, [line: 15], nil}]}, [do: {{:., [line: 15], [{:__aliases__, [line: 15], [:Map]}, :put]}, [line: 15], [{:self, [line: 15], nil}, :proposals, {{:., [line: 15], [{:__aliases__, [line: 15], [:Map]}, :delete]}, [line: 15], [{{:., [line: 15], [{:self, [line: 15], nil}, :proposals]}, [no_parens: true, line: 15], []}, {:k, [line: 15], nil}]}]}]]}, {:defp, [line: 16], [{:decisions, [line: 16], [{:self, [line: 16], nil}, {:k, [line: 16], nil}, {:v, [line: 16], nil}]}, [do: {{:., [line: 16], [{:__aliases__, [line: 16], [:Map]}, :put]}, [line: 16], [{:self, [line: 16], nil}, :decisions, {{:., [line: 16], [{:__aliases__, [line: 16], [:Map]}, :put]}, [line: 16], [{{:., [line: 16], [{:self, [line: 16], nil}, :decisions]}, [no_parens: true, line: 16], []}, {:k, [line: 16], nil}, {:v, [line: 16], nil}]}]}]]}, {:defp, [line: 17], [{:slot_in, [line: 17], [{:self, [line: 17], nil}]}, [do: {{:., [line: 17], [{:__aliases__, [line: 17], [:Map]}, :put]}, [line: 17], [{:self, [line: 17], nil}, :slot_in, {:+, [line: 17], [{{:., [line: 17], [{:self, [line: 17], nil}, :slot_in]}, [no_parens: true, line: 17], []}, 1]}]}]]}, {:defp, [line: 18], [{:slot_out, [line: 18], [{:self, [line: 18], nil}]}, [do: {{:., [line: 18], [{:__aliases__, [line: 18], [:Map]}, :put]}, [line: 18], [{:self, [line: 18], nil}, :slot_out, {:+, [line: 18], [{{:., [line: 18], [{:self, [line: 18], nil}, :slot_out]}, [no_parens: true, line: 18], []}, 1]}]}]]}, {:def, [line: 20], [{:start, [line: 20], [{:config, [line: 20], nil}, {:database, [line: 20], nil}, {:server_num, [line: 20], nil}]}, [do: {:__block__, [], [{:=, [line: 21], [{:self, [line: 21], nil}, {:%{}, [line: 21], [database: {:database, [line: 22], nil}, slot_in: 1, slot_out: 1, requests: [], proposals: {{:., [line: 26], [{:__aliases__, [line: 26], [:Map]}, :new]}, [line: 26], []}, decisions: {{:., [line: 27], [{:__aliases__, [line: 27], [:Map]}, :new]}, [line: 27], []}, leaders: nil, window_size: {{:., [line: 29], [{:config, [line: 29], nil}, :window_size]}, [no_parens: true, line: 29], []}, monitor: {{:., [line: 30], [{:config, [line: 30], nil}, :monitor]}, [no_parens: true, line: 30], []}, server_num: {:server_num, [line: 31], nil}]}]}, {:receive, [line: 34], [[do: [{:->, [line: 35], [[BIND: {:leaders, [line: 35], nil}], {:__block__, [], [{:=, [line: 36], [{:self, [line: 36], nil}, {{:., [line: 36], [{:__aliases__, [line: 36], [:Map]}, :put]}, [line: 36], [{:self, [line: 36], nil}, :leaders, {:leaders, [line: 36], nil}]}]}, {:|>, [line: 37], [{:self, [line: 37], nil}, {:next, [line: 37], [false]}]}]}]}]]]}]}]]}, {:defp, [line: 41], [{:propose, [line: 41], [{:self, [line: 41], nil}]}, [do: {:if, [line: 42], [{:and, [line: 42], [{:<, [line: 42], [{{:., [line: 42], [{:self, [line: 42], nil}, :slot_in]}, [no_parens: true, line: 42], []}, {:+, [line: 42], [{{:., [line: 42], [{:self, [line: 42], nil}, :slot_out]}, [no_parens: true, line: 42], []}, {{:., [line: 42], [{:self, [line: 42], nil}, :window_size]}, [no_parens: true, line: 42], []}]}]}, {:>, [line: 42], [{:length, [line: 42], [{{:., [line: 42], [{:self, [line: 42], nil}, :requests]}, [no_parens: true, line: 42], []}]}, 0]}]}, [do: {:__block__, [], [{:if, [line: 44], [{:not, [line: 44], [{{:., [line: 44], [{:__aliases__, [line: 44], [:Map]}, :has_key?]}, [line: 44], [{{:., [line: 44], [{:self, [line: 44], nil}, :decisions]}, [no_parens: true, line: 44], []}, {{:., [line: 44], [{:self, [line: 44], nil}, :slot_in]}, [no_parens: true, line: 44], []}]}]}, [do: {:__block__, [], [{:=, [line: 45], [{{:self, [line: 45], nil}, {:command, [line: 45], nil}}, {:|>, [line: 45], [{:self, [line: 45], nil}, {:pop_request, [line: 45], []}]}]}, {:=, [line: 46], [{:self, [line: 46], nil}, {:|>, [line: 46], [{:self, [line: 46], nil}, {:proposals, [line: 46], [{{:., [line: 46], [{:self, [line: 46], nil}, :slot_in]}, [no_parens: true, line: 46], []}, {:command, [line: 46], nil}]}]}]}, {:for, [line: 47], [{:<-, [line: 47], [{:leader, [line: 47], nil}, {{:., [line: 47], [{:self, [line: 47], nil}, :leaders]}, [no_parens: true, line: 47], []}]}, [do: {:send, [line: 48], [{:leader, [line: 48], nil}, {:{}, [line: 48], [:propose, {{:., [line: 48], [{:self, [line: 48], nil}, :slot_in]}, [no_parens: true, line: 48], []}, {:command, [line: 48], nil}]}]}]]}, {:|>, [line: 50], [{:|>, [line: 50], [{:self, [line: 50], nil}, {:slot_in, [line: 50], []}]}, {:propose, [line: 50], []}]}]}]]}, {:|>, [line: 52], [{:|>, [line: 52], [{:self, [line: 52], nil}, {:slot_in, [line: 52], []}]}, {:propose, [line: 52], []}]}]}, else: {:|>, [line: 54], [{:self, [line: 54], nil}, {:next, [line: 54], [false]}]}]]}]]}, {:defp, [line: 58], [{:perform, [line: 58], [{:self, [line: 58], nil}, {:=, [line: 58], [{:command, [line: 58], nil}, {:{}, [line: 58], [{:_client, [line: 58], nil}, {:_seq_num, [line: 58], nil}, {:transaction, [line: 58], nil}]}]}]}, [do: {:__block__, [], [{:for, [line: 59], [{:<-, [line: 59], [{:s, [line: 59], nil}, {:.., [line: 59], [0, {:-, [line: 59], [{{:., [line: 59], [{:self, [line: 59], nil}, :slot_out]}, [no_parens: true, line: 59], []}, 1]}]}]}, [do: {:if, [line: 60], [{:==, [line: 60], [{{:., [line: 60], [{:__aliases__, [line: 60], [:Map]}, :get]}, [line: 60], [{{:., [line: 60], [{:self, [line: 60], nil}, :decisions]}, [no_parens: true, line: 60], []}, {:s, [line: 60], nil}]}, {:command, [line: 60], nil}]}, [do: {:|>, [line: 61], [{:|>, [line: 61], [{:self, [line: 61], nil}, {:slot_out, [line: 61], []}]}, {:handle_decision, [line: 61], []}]}]]}]]}, {:if, [line: 64], [{:==, [line: 64], [{{:., [line: 64], [{:self, [line: 64], nil}, :server_num]}, [no_parens: true, line: 64], []}, 1]}, [do: {:__block__, [], []}]]}, {:send, [line: 69], [{{:., [line: 69], [{:self, [line: 69], nil}, :database]}, [no_parens: true, line: 69], []}, {:EXECUTE, {:transaction, [line: 69], nil}}]}, {:|>, [line: 70], [{:|>, [line: 70], [{:self, [line: 70], nil}, {:slot_out, [line: 70], []}]}, {:handle_decision, [line: 70], []}]}]}]]}, {:defp, [line: 73], [{:next, [line: 73], [{:self, [line: 73], nil}, {:handled, [line: 73], nil}]}, [do: {:if, [line: 74], [{:handled, [line: 74], nil}, [do: {:|>, [line: 75], [{:self, [line: 75], nil}, {:propose, [line: 75], []}]}, else: {:receive, [line: 77], [[do: [{:->, [line: 79], [[CLIENT_REQUEST: {:command, [line: 79], nil}], {:__block__, [], [{:send, [line: 80], [{{:., [line: 80], [{:self, [line: 80], nil}, :monitor]}, [no_parens: true, line: 80], []}, {:CLIENT_REQUEST, {{:., [line: 80], [{:self, [line: 80], nil}, :server_num]}, [no_parens: true, line: 80], []}}]}, {:=, [line: 81], [{:self, [line: 81], nil}, {:|>, [line: 81], [{:|>, [line: 81], [{:self, [line: 81], nil}, {:requests, [line: 81], [{:command, [line: 81], nil}]}]}, {:propose, [line: 81], []}]}]}, {:|>, [line: 82], [{:self, [line: 82], nil}, {:next, [line: 82], [false]}]}]}]}, {:->, [line: 84], [[{:{}, [line: 84], [:decision, {:slot, [line: 84], nil}, {:command, [line: 84], nil}]}], {:__block__, [], [{:=, [line: 85], [{:self, [line: 85], nil}, {:|>, [line: 85], [{:self, [line: 85], nil}, {:decisions, [line: 85], [{:slot, [line: 85], nil}, {:command, [line: 85], nil}]}]}]}, {:|>, [line: 86], [{:self, [line: 86], nil}, {:handle_decision, [line: 86], []}]}]}]}]]]}]]}]]}, {:defp, [line: 93], [{:handle_decision, [line: 93], [{:self, [line: 93], nil}]}, [do: {:if, [line: 94], [{{:., [line: 94], [{:__aliases__, [line: 94], [:Map]}, :has_key?]}, [line: 94], [{{:., [line: 94], [{:self, [line: 94], nil}, :decisions]}, [no_parens: true, line: 94], []}, {{:., [line: 94], [{:self, [line: 94], nil}, :slot_out]}, [no_parens: true, line: 94], []}]}, [do: {:__block__, [], [{:=, [line: 95], [{:decision_command, [line: 95], nil}, {{:., [line: 95], [{:__aliases__, [line: 95], [:Map]}, :get]}, [line: 95], [{{:., [line: 95], [{:self, [line: 95], nil}, :decisions]}, [no_parens: true, line: 95], []}, {{:., [line: 95], [{:self, [line: 95], nil}, :slot_out]}, [no_parens: true, line: 95], []}]}]}, {:if, [line: 96], [{{:., [line: 96], [{:__aliases__, [line: 96], [:Map]}, :has_key?]}, [line: 96], [{{:., [line: 96], [{:self, [line: 96], nil}, :proposals]}, [no_parens: true, line: 96], []}, {{:., [line: 96], [{:self, [line: 96], nil}, :slot_out]}, [no_parens: true, line: 96], []}]}, [do: {:__block__, [], [{:=, [line: 97], [{:proposal_command, [line: 97], nil}, {{:., [line: 97], [{:__aliases__, [line: 97], [:Map]}, :get]}, [line: 97], [{{:., [line: 97], [{:self, [line: 97], nil}, :proposals]}, [no_parens: true, line: 97], []}, {{:., [line: 97], [{:self, [line: 97], nil}, :slot_out]}, [no_parens: true, line: 97], []}]}]}, {:=, [line: 98], [{:self, [line: 98], nil}, {:|>, [line: 98], [{:self, [line: 98], nil}, {:remove_proposal, [line: 98], [{{:., [line: 98], [{:self, [line: 98], nil}, :slot_out]}, [no_parens: true, line: 98], []}]}]}]}, {:if, [line: 99], [{:!=, [line: 99], [{:decision_command, [line: 99], nil}, {:proposal_command, [line: 99], nil}]}, [do: {:|>, [line: 100], [{:|>, [line: 100], [{:self, [line: 100], nil}, {:requests, [line: 100], [{:proposal_command, [line: 100], nil}]}]}, {:perform, [line: 100], [{:decision_command, [line: 100], nil}]}]}]]}, {:|>, [line: 102], [{:self, [line: 102], nil}, {:perform, [line: 102], [{:decision_command, [line: 102], nil}]}]}]}]]}, {:|>, [line: 104], [{:self, [line: 104], nil}, {:perform, [line: 104], [{:decision_command, [line: 104], nil}]}]}]}, else: {:|>, [line: 106], [{:self, [line: 106], nil}, {:propose, [line: 106], []}]}]]}]]}]}]]}