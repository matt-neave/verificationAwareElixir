mtype = {SUM};
typedef MessageType {
byte data1[20];
int data2;
byte data3[20];
bool data4;
};
typedef
MessageList {
MessageType m1;
MessageType m2;
MessageType m3;
};
chan mailbox[1] = [10] of { mtype, MessageList };

init {
chan p0_mailbox = [10] of { mtype, MessageList };
chan p1_mailbox = [10] of { mtype, MessageList };
mailbox[0] = p0_mailbox;
int c_p;
c_p = run add();
mailbox[1] = p1_mailbox;
MessageList msg_0;
msg_0.m1.data2 = 10;
msg_0.m2.data2 = 12;
msg_0.m3.data2 = _pid;
mailbox[1] ! SUM, msg_0;
do
:: true ->
MessageList rev_v_0;
mailbox[_pid] ? messageType, rev_v_0;
if
:: messageType == other ->
:: else -> mailbox[_pid] ! messageType, rec_v_0;
fi;
od;
}

proctype add (chan ret) {
do
:: true ->
MessageList rev_v_1;
mailbox[_pid] ? messageType, rev_v_1;
if
:: messageType == sum ->
x = rev_v_1.m1.data2
y = rev_v_1.m2.data2
pid = rev_v_1.m3.data2
:: messageType == other ->
:: else -> mailbox[_pid] ! messageType, rec_v_1;
fi;
od;
}

